
name: Build Android
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    permissions: { contents: write }
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with: { node-version: 18 }
      - run: |
          npm init -y
          npm install @capacitor/core @capacitor/cli @capacitor/android
          mkdir -p dist
          cp -r web_files/* dist/ || true
          cp index.html dist/ || true
      - run: npx cap add android && npx cap sync
      - run: |
          cd android
          chmod +x gradlew
          ./gradlew assembleDebug
          cp app/build/outputs/apk/debug/app-debug.apk ../app-debug.apk
      - uses: softprops/action-gh-release@v1
        with:
          tag_name: v1.0.${{ github.run_number }}
          files: app-debug.apk
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
